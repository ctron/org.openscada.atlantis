<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://docbook.org/xml/4.4/docbookx.dtd" []>

<chapter id="connections"><title>Connection Adapters</title>
	<para>
		The different interfaces of <trademark>OpenSCADA</trademark> can all be accessed
		using different connection adapters. This ensures a greater portability across
		different systems and programming languages. Each functional interface (e.g. Data Access)
		has a programming language specific specification (interface) and a connection specific
		specification (protocol specification).
	</para>
	<para>
		So, for example, the DA interface consists of two interfaces in <trademark>Java</trademark>.
		They are called <interfacename>Hive</interfacename> and <interfacename>Connection</interfacename>.
		The <interfacename>Hive</interfacename> interface is the server side and
		<interfacename>Connection</interfacename> the client side<footnote><para>The difference between client and
		server was made in order to let the server aggregate several client connections and, on the
		other side, reduce the complexity of the client interface.</para></footnote>.
		Also there currently exist two protocol specifications for the <acronym>DA</acronym> interface.
		The first is based in the <acronym>GMPP</acronym> protocol, which is a proprietary protocol
		developed by <trademark>OpenSCADA</trademark>. The second is <acronym>ICE</acronym> from a
		company called <trademark>ZeroC</trademark>. Both protocols have the specifics but for both we
		have a mapping for the <trademark>OpenSCADA</trademark> DA interface. So in addition to the
		<trademark>Java</trademark> interfaces and the protocol specification there are wrappers around
		the <trademark>Java</trademark> interfaces which map them to the protocol specification. This
		allows developers of clients and server to focus on the sole implementation of their application
		since they don not need to care about protocol issues. On the other side if one wants to connect
		to <trademark>OpenSCADA</trademark> using a programming language which is currently not
		supported by <trademark>OpenSCADA</trademark> (and I guess there are lots ;-)) he only needs
		to focus on implementing the protocol specification. 
	</para>

	<sect1><title>URI format</title>
		<para>
			<trademark>OpenSCADA</trademark> uses the known URI format for connection information. The
			interpretation of the different components of the URI depend on the connection adapter.
		</para>
		<para>
			The basic format is:
			<programlisting>
			interface:connection://username:password@primaryTarget:secondaryTarget/several/additions?para1=value1&amp;para2=value2
			</programlisting>
		</para>
		<para>
		Where <quote>interface</quote> is the type of interface that the connections describes
		(e.g. <quote>da</quote> for <acronym>DA</acronym> or <quote>ae</quote> for <acronym>AE</acronym>).
		And <quote>connection</quote> is the name of the connection adapter (e.g. <quote>net</quote>
		for <acronym>GMPP</acronym> or <quote>ice</quote> for <acronym>ICE</acronym>).
		</para>
		<para>
			<quote>primaryTarget</quote> and <quote>secondaryTarget</quote> would normally match to
			hostname (or IP address) and port number.
		</para>
		<para>
			The query (parameters) part of the URI is used as <quote>connection parameters</quote>
			or <quote>connection properties</quote>.
		</para>
		<para>
			In addition, in some cases, the fragment part can be used to add a data item to the URI.
			This is for example used in the URI format of drag and drop operations of data items.
		</para>
	</sect1>

	<sect1><title>GMPP / NET</title>
		<para>
			The <acronym>GMPP</acronym> / <acronym>NET</acronym><footnote>
			<para>Do not mix up with <acronym>.NET</acronym></para></footnote> protocol is a plain
			TCP client/server based protocol.
		</para>
		
		<sect2><title>Connection URI</title>
			<para>
				The connection type identifier is <quote>net</quote>.
			</para>
			
			<table><title>GMPP connection URI parts</title>
				<tgroup cols="3">
				<thead>
					<row>
						<entry>URI Part</entry>
						<entry>Required</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>Primary Target</entry>
						<entry>required</entry>
						<entry>
							The hostname of IP address of the server or the network interface
							to which the server should bind. Can be <quote>0.0.0.0</quote> to bind
							on any interface.
						</entry>
					</row>
					<row>
						<entry>Secondary Target</entry>
						<entry>required</entry>
						<entry>
							The number of the port the client should connect to or the server
							should bind to. 
						</entry>
					</row>
					<row>
						<entry>Path</entry>
						<entry>not used</entry>
						<entry></entry>
					</row>
				</tbody>
				</tgroup>
			</table>			
		</sect2>
		
		<sect2><title>Connection properties</title>
			<para>
				The following connection properties are supported
			</para>
			<table><title>GMPP connection properties</title>
				<tgroup cols="4">
				
				<colspec colwidth="2*" align="left"/>
				<colspec colwidth="*" align="left"/>
				<colspec colwidth="*" align="left"/>
				<colspec colwidth="3*" align="left"/>
				
				<thead>
					<row>
						<entry>Property</entry>
						<entry>Required</entry>
						<entry>Default value</entry>
						<entry>Description</entry>
					</row>
				</thead>
				
				<tbody>
					<row>
						<entry>trace</entry>
						<entry>optional</entry>
						<entry><emphasis>not set</emphasis></entry>
						<entry>If set to any value it will enable the <trademark>Apache Mina</trademark>
						logging options and inject a logging handler in the <interfacename>IoSession</interfacename>.
						</entry>
					</row>
					
					<row>
						<entry>compress</entry>
						<entry>optional</entry>
						<entry><emphasis>not set</emphasis></entry>
						<entry>If set to any value it will enable the <trademark>Apache Mina</trademark>
						compression filter.
						<note><para>This option has to be enabled on both server and client! Otherwise
						communication will not be possible.
						</para></note>
						</entry>
					</row>
					
					<row>
						<entry>timeout</entry>
						<entry>optional</entry>
						<entry>10000</entry>
						<entry>The default timeout value in milliseconds for all other (more specific) timeouts.</entry>
					</row>
					
					<row>
						<entry>connectTimeout</entry>
						<entry>optional</entry>
						<entry>Defaults to <quote>timeout</quote></entry>
						<entry>The timeout in milliseconds when establishing a new connection to a server</entry>
					</row>
					
					<row>
						<entry>messageTimeout</entry>
						<entry>optional</entry>
						<entry>Defaults to <quote>timeout</quote></entry>
						<entry>The default timeout in milliseconds for each message sent using the
						<acronym>GMPP</acronym> protocol. This may be overridden on a message
						by message basis when passing a message to the protocol stack.
						</entry>
					</row>
					
					<row>
						<entry>pingDelay</entry>
						<entry>optional</entry>
						<entry><quote>messageTimeout</quote> divided by <quote>pingFrequency</quote></entry>
						<entry>The time (in milliseconds) after which a ping packet will be sent if
						no other packet was received during that time.</entry>
					</row>
					
					<row>
						<entry>pingFrequency</entry>
						<entry>optional</entry>
						<entry>3</entry>
						<entry>The number of packets which will be sent in the time of <quote>messageTimeout</quote>
						unless overridden by <quote>pingDelay</quote> and unless no other packets arrive.
						</entry>
					</row>
					
					<row>
						<entry>socketImpl</entry>
						<entry>optional</entry>
						<entry>NIO</entry>
						<entry>The socket implementation to use. See <xref linkend="connections_socketImpl"/>
						for possible values</entry>
					</row>
					
					<row>
						<entry>ssl</entry>
						<entry>optional</entry>
						<entry>false</entry>
						<entry>Indication whether to turn on the <acronym>SSL</acronym> engine or not.
						All following parameters starting with <quote>ssl</quote> will be ignored if
						<acronym>SSL</acronym> is disabled.
						<note><para>This option has to be enabled on both server and client! Otherwise
						communication will not be possible.
						</para></note>
						</entry>
					</row>
					
					<row>
						<entry>sslProtocol</entry>
						<entry>optional</entry>
						<entry>SSLv3</entry>
						<entry>Specifies the <acronym>SSL</acronym> protocol to use. Must be a supported
						constant from the Java virtual machine that is being used.</entry>
					</row>
					
					<row>
						<entry>sslRandom</entry>
						<entry>optional</entry>
						<entry><emphasis>The virtual machine default</emphasis></entry>
						<entry>The random number provider used for the <acronym>SSL</acronym> context.</entry>
					</row>
					
					<row>
						<entry>sslKeyStoreType</entry>
						<entry>optional</entry>
						<entry><emphasis>The virtual machine default</emphasis></entry>
						<entry>The password to the key store located at <quote>sslKeyStoreUri</quote></entry>
					</row>
					
					<row>
						<entry>sslKeyStorePassword</entry>
						<entry>optional</entry>
						<entry><emphasis>none</emphasis></entry>
						<entry>The password to the key store located at <quote>sslKeyStoreUri</quote></entry>
					</row>
					
					<row>
						<entry>sslCertPassword</entry>
						<entry>optional</entry>
						<entry><emphasis>none</emphasis></entry>
						<entry>The password of the certificate to use</entry>
					</row>
					
					<row>
						<entry>sslKeyStoreUri</entry>
						<entry>optional</entry>
						<entry><emphasis>none</emphasis></entry>
						<entry>
						The URI to the key store file to use.
						<note><para>If the key store is located in the local file system
						the prefix <filename>file:/</filename> <emphasis>has</emphasis>
						to be used!
						</para></note>
						</entry>
					</row>
					
				</tbody>
				
				</tgroup>
			</table>
			<para>
				For SSL constant names see <ulink url="http://java.sun.com/javase/6/docs/technotes/guides/security/StandardNames.html">
				<citetitle>Java&trade; Cryptography Architecture Standard Algorithm Name Documentation</citetitle>
				</ulink> or the equivalent documentation of the virtual machine you are using. 
			</para>
		</sect2>
		
		<sect2 id="connections_socketImpl"><title>Socket implementations</title>
		<para>
			At the moment the following socket implementations can be used:
			<variablelist>
			
			<varlistentry>
				<term>NIO</term>
				<listitem>
				<para>Java NIO based implementation.</para>
				</listitem>
			</varlistentry>
			
			<varlistentry>
				<term>VM</term>
				<listitem>
				<para>VM internal pseudo-socket implementation.</para>
				</listitem>
			</varlistentry>
			
			<varlistentry>
				<term>APR</term>
				<listitem>
				<para>Based on Apache Portable Runtime. Needs <filename>libapr.so</filename> or
				<filename>apr.dll</filename></para>
				</listitem>
			</varlistentry>
			
			</variablelist>
		</para>
		</sect2>
		
	</sect1>
</chapter>